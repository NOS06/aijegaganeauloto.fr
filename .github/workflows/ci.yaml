name: "CI"

on:
   pull_request:
   push:
       branches:
           - 'master'

env:
   fail-fast: true

jobs:
   test:
       runs-on: 'ubuntu-latest'
       steps:
           - name: "Checkout code"
             uses: actions/checkout@v2.3.3

           - name: "Install PHP with extensions"
             uses: shivammathur/setup-php@2.7.0
             with:
                 coverage: "none"
                 extensions: "intl, mbstring, pdo_pgsql"
                 php-version: '8.0'
                 tools: composer:v2

           - name: "Set composer cache directory"
             id: composer-cache
             run: echo "::set-output name=dir::$(composer config cache-files-dir)"

           - name: "Cache composer"
             uses: actions/cache@v2.1.2
             with:
                 path: ${{ steps.composer-cache.outputs.dir }}
                 key: composer-${{ hashFiles('composer.json') }}
                 restore-keys: composer-

           - name: "Composer install"
             run: composer install

           - name: "Install PHPUnit for PHP 8"
             run: vendor/bin/simple-phpunit install

           - name: "PHPUnit version"
             run: vendor/bin/simple-phpunit --version

           - name: "Run tests"
             run: vendor/bin/simple-phpunit
